!function(){var t,e,n,o,r=[].slice,s={}.hasOwnProperty,i=function(t,e){function n(){this.constructor=t}for(var o in e)s.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};t="undefined"!=typeof window&&null!==window?window.Backbone.Events:require("backbone").Events,n=function(e){var n,o,r;r=[];for(n in t)o=t[n],r.push(e[n]=o);return r},e={},e.Message=function(){function t(t,e,n){null==t&&(t=""),null==e&&(e=void 0),this.options=null!=n?n:{},this._hidden=e&&"cookie"===this.options.store&&"undefined"!=typeof cookie&&null!==cookie?cookie.get("noted_"+e+"_hidden")||!1:e&&"store"===this.options.store&&"undefined"!=typeof store&&null!==store?store.get("noted_"+e+"_hidden")||!1:!1,this.setBody(t),this.setId(e),this.listenTo(this,"hide",this._hide)}return t.prototype.getBody=function(){return this.body},t.prototype.setBody=function(t){this.body=t},t.prototype.delivered=!1,t.prototype.isDelivered=function(){return this.delivered},t.prototype.setDelivered=function(t){this.delivered=null!=t?t:!0},t.prototype.getId=function(){return this._id},t.prototype.setId=function(t){this._id=t},t.prototype.isHidden=function(){return this._hidden},t.prototype.hide=function(t){return this.trigger("hide",t)},t.prototype._hide=function(t,e){return null==e&&(e=!1),this._hidden=!0,e?void 0:"cookie"===this.options.store&&"undefined"!=typeof cookie&&null!==cookie?cookie.set("noted_"+this.getId()+"_hidden",!0):"store"===this.options.store&&"undefined"!=typeof store&&null!==store?store.set("noted_"+this.getId()+"_hidden",!0):void 0},t}(),n(e.Message.prototype),e.Message.prototype.trigger=function(){var e,n,o;return n=arguments[0],e=2<=arguments.length?r.call(arguments,1):[],(o=t.trigger).call.apply(o,[this,n,this].concat(r.call(e)))},e.Event=function(){function t(t,e){this.group=t,this.name=e,this._messages=[]}return t.prototype.getName=function(){return this.name},t.prototype.getMessages=function(){return this._messages},t.prototype.add=function(t){return this._messages.push(t)},t.prototype.getGroup=function(){return this.group},t.prototype.setGroup=function(t){this.group=t},t}(),n(e.Event.prototype),e.EventGroup=function(){function t(t){this.name=t,this._eventObjs={}}return t.prototype.getName=function(){return this.name},t.prototype.add=function(t){return t instanceof e.Event?(this._eventObjs[t.getName()]=t,t.setGroup(this),t):this._eventObjs[t]=new e.Event(this,t)},t.prototype.all=function(){var t,e,n,o;n=[],o=this._eventObjs;for(e in o)t=o[e],n.push(t);return n},t.prototype.get=function(t){return this._eventObjs[t]},t.prototype.remove=function(t){var n;return n=t instanceof e.Event?t.name:t,delete this._eventObjs[n]},t}(),n(e.EventGroup.prototype),e.Broker=function(){function t(){this._eventGroups={}}return t.prototype.subscribe=function(t,e,n,o){var s,i,u,p,h,a,c,l,d,f,g,y,v,_;if(null==o&&(o={}),s=this.get(t),h=function(){var n;return n=1<=arguments.length?r.call(arguments,0):[],t="string"==typeof n[0]?n[1]:n[0],t.setDelivered(),e.apply(this,n)},h._callback=e,o.delayed)if("all"===s.getName()){i=[s.getGroup()]||this._eventGroups;for(p in i)for(u=i[p],y=u.all(),a=0,d=y.length;d>a;a++)for(s=y[a],v=s.getMessages(),c=0,f=v.length;f>c;c++)t=v[c],o.undelivered&&t.isDelivered()||t.isHidden()||h.call(n,s.getName(),t)}else for(_=s.getMessages(),l=0,g=_.length;g>l;l++)t=_[l],o.undelivered&&t.isDelivered()||t.isHidden()||h.call(n,t);return s.getGroup().on(s.getName(),h,n)},t.prototype.publish=function(t,n,o){var r,s,i,u,p;return null==o&&(o={}),p=this.parse(t),u=p[0],u=p[1],i=p[2],r=this.get(t),t=new e.Message(n,i,o),r.add(t),t.isHidden()||r.getGroup().trigger(r.getName(),t),o.hideAfter&&(s=function(){return t.hide(o.storeHide?!o.storeHide:void 0)},setTimeout(s,o.hideAfter)),t},t.prototype.unsubscribe=function(t,e,n){var o,r,s,i,u;if(t)return o=this.get(t),o.getGroup().off(o.getName(),e,n);i=this._eventGroups,u=[];for(s in i)r=i[s],u.push(r.off(null,e,n));return u},t.prototype.get=function(t){var n,o,r,s,i,u;return u=this.parse(t),r=u[0],n=u[1],s=u[2],o=(i=this._eventGroups)[r]||(i[r]=new e.EventGroup(r)),o.get(n)||o.add(n)},t.prototype.parse=function(t){var e,n,o,r;return r=t.match(/(?:(.+):|)([^#]*)(?:#(.+)|)/).slice(1),n=r[0],e=r[1],o=r[2],[n,e||"all",o]},t}(),e.MessagesList=function(){function t(t,e){this._messages=[],this._events={},n(this._events),this.setBroker(t),this.setContext(e)}return t.prototype.getBroker=function(){return this.broker},t.prototype.setBroker=function(t){this.broker=t},t.prototype.getContext=function(){return this.context},t.prototype.setContext=function(t){this.context=t},t.prototype.getMessages=function(){return this._messages},t.prototype.store=function(t){var e;return this._messages.push(t),e=function(){var t,e,n;return e=arguments[0],t=2<=arguments.length?r.call(arguments,1):[],(n=this._events).trigger.apply(n,[e].concat(r.call(t)))},t.on("all",e,this),t},t.prototype.trigger=function(){var t,e,n,o,s,i,u,p,h,a,c,l;for(s=arguments[0],o=arguments[1],n=3<=arguments.length?r.call(arguments,2):[],"string"==typeof s?(p={},e=s,t=[o].concat(n)):(p=s,e=o,t=n),u=function(){var t,e,n;if(p.hidden)return this._messages;for(h=[],n=this._messages,t=0,e=n.length;e>t;t++)i=n[t],i.isHidden()||h.push(i);return h}.call(this),l=[],a=0,c=u.length;c>a;a++)i=u[a],l.push(i.trigger.apply(i,[e].concat(r.call(t))));return l},t.prototype.on=function(t,e){return this._events.on(t,e,this.context)},t.prototype.off=function(t,e){return this._events.off(t,e)},t}(),e.Emitter=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.emit=function(t,e,n){return t=this.broker.publish(t,e,n),this._messages.push(t),t},e}(e.MessagesList),e.Receiver=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.listen=function(t,e,n){var o,s;return null==n&&(n={}),o=this,s=function(){var t,n;return n=arguments[0],t=2<=arguments.length?r.call(arguments,1):[],o._messages.push(n),e.apply(this,arguments)},e._callback=s,this.broker.subscribe(t,s,this.context,n)},e.prototype.stop=function(t,e){return this.broker.unsubscribe(t,(null!=e?e._callback:void 0)||e,this.context)},e}(e.MessagesList),"undefined"!=typeof window&&null!==window?window.Noted=e:module.exports=e}.call(this);